const { jsPDF } = require('jspdf');

function downloadCoverLetterAsPDF(coverLetter, fileName) {
    const doc = new jsPDF();

    doc.setFont("times", "normal");
    doc.setFontSize(12);
    doc.setLineHeightFactor(1.5);

    const pageWidth = doc.internal.pageSize.width;
    const pageHeight = doc.internal.pageSize.height;
    const margin = 20;
    const contentWidth = pageWidth - (margin * 2);
    const maxContentHeight = pageHeight - (margin * 2);

    let fontSize = 12;
    let lineHeightFactor = 1.5;
    let lines;
    let totalTextHeight;

    do {
        doc.setFontSize(fontSize);
        doc.setLineHeightFactor(lineHeightFactor);

        // Split text into lines based on current settings
        lines = doc.splitTextToSize(coverLetter, contentWidth);

        // Calculate total height needed
        totalTextHeight = lines.length * (fontSize * lineHeightFactor / 72 * 25.4);

        // If text doesn't fit, reduce font size or line height
        if (totalTextHeight > maxContentHeight) {
            if (fontSize > 8) {
                fontSize -= 0.5;
            } else if (lineHeightFactor > 1.0) {
                lineHeightFactor -= 0.1;
            } else {
                // We've reached minimum settings, can't reduce further
                break;
            }
        }
    } while (totalTextHeight > maxContentHeight);

    // Add text to the document
    let currentY = margin;
    for (const line of lines) {
        doc.text(line, margin, currentY, {
            align: "justify"
        });
        currentY += (fontSize * lineHeightFactor / 72 * 25.4);
    }

    // Save the PDF
    doc.save(`${fileName}.pdf`);
}

const coverLetter = "Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptatibus modi sit neque repudiandae, saepe in eveniet consequuntur ea possimus! Aliquid suscipit quaerat tempore eum ratione aliquam repudiandae laboriosam debitis illo, hic enim molestiae fugiat natus? Veritatis ea earum blanditiis, facilis molestias dignissimos odio, itaque aliquid, quo sit repudiandae inventore maxime commodi dolorem laborum autem nostrum rem repellat distinctio animi iure recusandae esse est aperiam? Excepturi beatae repellat, fuga quos quia voluptatibus accusamus nulla, blanditiis corrupti, minus corporis repudiandae nisi in architecto pariatur quibusdam dolores quaerat maxime ratione expedita! Cupiditate qui autem minima vel atque, eaque et ullam! Quas dolor omnis assumenda dolorem, tempora temporibus beatae illo. Suscipit ea excepturi earum dolore magni illum molestias cumque perspiciatis distinctio quo quia sint magnam tenetur neque, hic non animi cum, enim officia consequatur? Eum harum impedit nisi, reprehenderit ab minus aspernatur quod animi odio voluptate culpa dolor blanditiis dolore libero corporis cum aperiam laborum adipisci voluptates tenetur, odit quas. Optio ea nesciunt distinctio amet, explicabo nisi ullam? Facere voluptate beatae fugit nesciunt totam aliquid perspiciatis neque nobis sequi voluptatem. Perspiciatis, aperiam facere odio voluptatem debitis tenetur eius quod impedit, dignissimos quidem ipsa magni alias eligendi natus veniam enim, nostrum mollitia totam deserunt minus eos corrupti quis velit laudantium! Quos ipsa, exercitationem ducimus expedita enim hic voluptas nobis praesentium, doloribus cupiditate modi reprehenderit iure dolorem porro nesciunt earum dolor qui, alias ratione? Enim suscipit possimus, quo, saepe consequuntur voluptas iusto quia molestias obcaecati mollitia illo. Commodi dignissimos quo veritatis omnis voluptas provident cupiditate? Ad laboriosam quasi inventore, suscipit nobis ea incidunt laudantium magnam itaque quisquam repudiandae voluptatem repellat harum dicta, molestiae similique voluptas voluptate quibusdam? Dolorem vel nobis at aliquam culpa eligendi voluptas consequuntur repellat, fuga quis itaque incidunt, quae porro iure reiciendis rem! Aspernatur quis, non aut odio obcaecati numquam quod beatae id deserunt, ex sint? Cumque sit error sunt ipsum asperiores facilis hic blanditiis fugit ducimus praesentium, quaerat animi iusto, deleniti facere molestiae quia eaque, eligendi vitae repellat veniam magni consequuntur. Aliquam, repellat commodi praesentium, consectetur nesciunt temporibus architecto nemo nulla tempore deserunt quidem consequuntur cum quam fuga repudiandae earum delectus assumenda! Sapiente labore, fuga minus tenetur numquam, vitae, fugit dolorem obcaecati magni veniam quas hic nam sint itaque ipsum esse asperiores veritatis harum cupiditate voluptatum recusandae? Sed cupiditate iste hic atque distinctio. Qui dolor assumenda, saepe molestias totam, explicabo nulla repellat excepturi pariatur obcaecati voluptatibus ullam architecto? Sit sunt dignissimos accusantium distinctio, ex incidunt laborum quasi labore vitae minus expedita quia atque modi excepturi nobis cum ullam ad amet provident alias mollitia deleniti est. Saepe tempora nostrum ut consequuntur, nihil fugit, odio quisquam iste provident repellendus recusandae. Amet iste eius optio consectetur sint ullam nisi quasi, nihil consequatur atque temporibus quas nulla quia sapiente aliquid fugiat, suscipit nesciunt totam veniam commodi. Possimus corporis doloribus recusandae aspernatur quas error est odio ea incidunt voluptatum, dolor numquam id molestiae soluta perspiciatis natus itaque, alias fuga, vitae ipsum voluptas omnis? Rem, hic veritatis sed illo suscipit perspiciatis consequuntur, aperiam dolores, saepe ipsa repellat! Repellat, earum similique cupiditate inventore sit soluta at quasi odit odio ipsum hic commodi? Voluptatum aliquam doloremque quae voluptate reiciendis praesentium non quas et. Laudantium reprehenderit, dignissimos, possimus, adipisci esse tempore quas vero illum magni est deserunt quia officiis nostrum! Ipsam tempora, sed eum a quidem sint corrupti nisi rerum velit harum temporibus! Rem explicabo dolorum, ut consequatur dolor facilis velit recusandae aspernatur quia vitae delectus quo earum eos consectetur! Impedit minus similique porro labore dolorem quisquam commodi explicabo totam beatae, atque in animi ipsum voluptatibus omnis et odio itaque dolore. Quibusdam repellendus sed quisquam possimus harum magni corporis sapiente, ea, magnam dicta omnis. Itaque consectetur dolorum commodi sunt animi omnis, amet rem minima necessitatibus expedita velit illum eos, tempora corporis? Veniam fugit possimus suscipit qui fugiat? Tempore cupiditate sequi dolorem? Perferendis odio illo unde rem earum quaerat. Et voluptatum voluptatem quisquam perspiciatis tenetur alias cupiditate illum doloribus repudiandae earum. Exercitationem eveniet soluta sit tempore animi a voluptatibus nostrum vitae error velit mollitia voluptate vero, accusantium consequatur perspiciatis molestias dolor quia nobis quaerat iusto numquam! Saepe, architecto ex. Tenetur ullam quas tempora itaque cumque perspiciatis eligendi nostrum, cupiditate sapiente quis blanditiis exercitationem at deleniti dolore ut necessitatibus, vel officia assumenda rem voluptates animi. Nobis optio sunt distinctio, eaque amet, adipisci ex facere ullam veritatis atque, ipsum saepe accusamus ut dolorum culpa. Non error, recusandae nemo dolorem nihil qui. A ad deleniti sit. Doloribus est eveniet optio, ab, blanditiis recusandae, magnam ullam ratione porro distinctio nostrum! Sit similique saepe omnis est nostrum! Provident non ab quaerat quibusdam. Assumenda delectus laudantium impedit harum eius tempore perferendis. Velit cupiditate eius molestias delectus consequuntur eum, officia quidem ducimus quibusdam a modi. Dicta hic temporibus ex rem, facilis vitae at sit, totam ducimus, architecto perferendis nostrum! Nostrum ratione harum nulla sequi facilis quae suscipit, exercitationem ipsum obcaecati sed, non architecto iste distinctio odit? Unde atque inventore ipsam ullam non blanditiis, aspernatur, recusandae distinctio nihil incidunt sit ipsa itaque? Neque provident, architecto vel eius dolorum sunt doloribus placeat voluptas sequi ut incidunt voluptates nihil. Fugiat, doloremque quaerat at nihil blanditiis cupiditate, ab non reiciendis deleniti aperiam eveniet sapiente ex tenetur dolorem qui nam excepturi ipsa fugit, consequatur quo eos corrupti quod? Aspernatur ad amet quam asperiores cupiditate ipsa molestias recusandae aut accusamus aliquid quas dolor eligendi sequi, debitis excepturi esse placeat nesciunt doloribus commodi odit porro ullam? Totam nesciunt blanditiis quos quidem nihil, sequi tempore quia iusto quod rem, provident magnam asperiores libero, ea odit? Iure, accusamus vitae! Minima dolor deserunt quo, illum ex voluptas recusandae officia quae suscipit, laborum obcaecati eos soluta consequuntur, aperiam tempora? Voluptates maiores velit cumque dicta nihil maxime eius amet accusantium rem qui labore adipisci sunt itaque facere voluptatem perferendis, doloribus, nulla deserunt nisi eum, quisquam aliquam ad temporibus dignissimos. Possimus veniam, totam pariatur nam, iusto, quidem eveniet porro illo in cumque debitis saepe quas? Ex, rerum provident. Consectetur reiciendis magnam vel dolorem nulla nihil est facere et cupiditate, ipsa aliquam ratione facilis possimus, hic quo, sit nemo eligendi rem officiis sunt molestias dignissimos. Dicta in nihil exercitationem a rerum error voluptatum aliquid perspiciatis, velit optio dolores magnam animi consectetur accusantium voluptate quae voluptates corporis fugiat quaerat modi similique. Sit, placeat enim fugit at dolorem minima soluta cum saepe exercitationem itaque optio quasi deleniti perspiciatis iure. Explicabo deleniti doloribus hic praesentium accusantium inventore perferendis vitae dolorum. Sapiente nulla saepe quibusdam cupiditate sit atque explicabo recusandae veritatis quae consequuntur ipsam, molestias id voluptatum qui beatae doloribus minima est. Accusantium in fuga rem hic quos quia veritatis, qui explicabo saepe, incidunt repellat nemo ipsam dicta! Dolores a, repellat delectus sit ab autem quisquam impedit veritatis tempore facere molestias accusantium, non, eveniet enim! Maxime dicta ea nemo deleniti error fuga ipsum hic at eum distinctio sunt ducimus aspernatur accusantium quidem magnam facilis neque, iure nostrum. Cumque aperiam atque ea suscipit dolor possimus ratione nesciunt animi maiores tempora ipsum quo totam nam distinctio officiis, consequuntur pariatur quod eius, nemo cum esse rerum architecto! Fugit, veritatis. Asperiores, alias assumenda, vero recusandae illum, est quos odit commodi eveniet nesciunt facere rem sapiente ullam et molestiae earum beatae. Ullam illum consequatur, fugiat amet ducimus corrupti sapiente debitis fuga culpa alias libero facilis totam doloremque impedit sed quidem dignissimos suscipit reprehenderit, eveniet corporis earum? Minus harum voluptates laboriosam id reprehenderit dolorem, aperiam natus iure tempora? Quidem consequatur eligendi excepturi laudantium esse ipsa mollitia aperiam sint, nam repellendus quasi placeat odio aliquid, asperiores quisquam natus, est commodi optio aspernatur necessitatibus sapiente? Sint ipsa obcaecati nam optio, fugit pariatur expedita magni quaerat iure maiores quisquam exercitationem facere vel, perferendis sunt eum quia quo temporibus, consequuntur quasi accusantium fuga provident soluta? Id commodi excepturi voluptate quibusdam, iusto, expedita suscipit adipisci dolores, saepe doloremque aut ea minus eius hic incidunt nihil. Repudiandae eaque similique ratione, sunt ipsam vel labore quod optio cumque impedit fugit velit aliquid numquam quo maiores. Ratione eos accusantium rerum ut harum nam perspiciatis eligendi libero repudiandae cupiditate aut ipsum praesentium, tenetur nesciunt vitae est quos, sapiente accusamus dicta expedita, rem inventore deserunt velit? Exercitationem possimus necessitatibus magnam excepturi sequi. Ipsum, totam quis, optio iure explicabo ab quasi unde laboriosam modi ut maxime animi corrupti eaque ipsam quae accusamus ullam voluptates earum. Maxime officia quam repudiandae laudantium similique nulla ipsa dicta vel porro odit repellendus earum, reprehenderit rem beatae ex? Ipsa ratione earum aspernatur dolorem corporis voluptas nulla quia libero dicta. Pariatur placeat ullam iusto, delectus modi illo? Omnis temporibus quidem facere ullam nulla eum, soluta ratione placeat incidunt molestias, reprehenderit maiores quae cumque fuga dolore. Laudantium eaque omnis consequuntur similique animi fuga temporibus. Natus odio facere sunt esse quia qui, magnam ducimus quis. Minus a dicta quod sint maxime ipsa unde, sed praesentium eum odit doloremque nobis? Earum beatae fuga velit optio officiis aperiam nesciunt porro quo autem pariatur nam sunt assumenda, accusantium quidem consectetur ea. Atque, vel? Rerum modi, eveniet aut voluptatibus ut repudiandae repellendus totam, debitis assumenda impedit, nam eos! Voluptate aperiam architecto consequuntur pariatur autem. Odio, expedita eos magnam incidunt accusantium debitis enim nobis. Odit vel tempora explicabo beatae dicta fugiat delectus sunt reiciendis autem minus repudiandae veniam praesentium eos maxime quisquam incidunt dolorem, optio, vitae suscipit, natus minima iure et laudantium? Reprehenderit deserunt, delectus dignissimos pariatur culpa esse saepe optio ratione. Atque ab repellat, dolore temporibus, eius ipsam exercitationem est veritatis distinctio laudantium accusantium. Repellat aut iure odio, labore minima magni adipisci tenetur accusamus quidem ex ullam exercitationem cum quisquam pariatur consequuntur natus. Eum itaque, omnis fugit quis veniam illum amet quam saepe consequatur aliquid esse! Quisquam modi, hic ut dolorum error rerum inventore suscipit sunt et officiis consequuntur nisi provident? Quia, provident minima? Eos id non corporis tempore, deleniti quia praesentium, iusto mollitia repellendus at inventore. Corporis vel minima fugit libero voluptate dolorum possimus eius? Impedit, perspiciatis? Laborum aliquid quae maiores quam eos. Culpa libero reprehenderit ab molestias natus et quae! Aliquam eius esse quod. Inventore aut, expedita tempore tenetur vero sunt, repellat dolorum at facilis aperiam asperiores similique quod, voluptatibus voluptatem. Voluptate praesentium deleniti sint corrupti commodi eius eligendi aliquam error placeat delectus alias odit nobis aliquid autem repellat molestias, omnis, voluptates ullam est doloremque nam atque, beatae eveniet! Cumque porro odit optio, repellendus et ea ipsa ducimus ad distinctio quaerat voluptatem dolore explicabo commodi vel adipisci rem reiciendis inventore suscipit. Unde hic nihil ex recusandae cum facere, aperiam illo at voluptate modi deleniti maiores commodi, nam consequuntur fuga molestiae mollitia blanditiis minus eaque asperiores tempore omnis. Omnis odit repellendus iure debitis, earum error saepe ipsum quidem recusandae praesentium est accusantium dolorem beatae quisquam repudiandae ullam doloremque quas modi eum minus quia deleniti quo, id sit. Quod provident placeat aut optio assumenda, animi, tempora quisquam perspiciatis est quidem odio totam debitis, porro amet molestiae facere cum consequatur voluptas eaque doloribus? In delectus consequatur iusto totam enim quibusdam rerum, minus magnam, labore earum, modi sed deleniti inventore nobis temporibus perferendis ab vel. Ex, tempore. Culpa suscipit necessitatibus ex eius veniam nostrum quam aspernatur, itaque, cupiditate, quae amet! Totam tenetur repellat nam nisi a eos sunt voluptate, ipsum tempora unde, et animi perferendis qui deleniti asperiores nemo, quisquam repudiandae recusandae? Maxime quo illo, alias tempora illum minus non quas, ullam neque incidunt, maiores magnam quia corrupti aut beatae ducimus hic numquam! Delectus minima, ad quo vel facilis nihil velit dolor non magnam ratione excepturi unde? Praesentium ut placeat doloremque dolore corrupti cum sequi quia hic nam, deserunt commodi cupiditate numquam deleniti eum vel amet nulla id consectetur! Architecto perferendis laudantium aperiam possimus laboriosam consequatur inventore delectus odio cupiditate. Numquam quos illo illum reprehenderit nulla possimus ipsa quas dicta, alias natus et deserunt quod repellat totam, autem explicabo? Molestias voluptas quibusdam sapiente distinctio deserunt, similique reiciendis eos sint fugit in vero deleniti consequuntur vitae, nihil doloribus minima cum corporis laboriosam necessitatibus? Asperiores quis voluptatum sit aut iusto reprehenderit quibusdam, blanditiis non quam repellendus, optio sed vero deleniti fuga! Placeat quos voluptatum earum quibusdam tempora expedita incidunt repellendus dicta, assumenda, ullam deleniti mollitia non quis voluptas nobis! Et neque quasi vitae doloribus. Quisquam est asperiores ipsam necessitatibus blanditiis?";
const fileName = "cover_letter";
downloadCoverLetterAsPDF(coverLetter, fileName);